<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Map Dashboard - FRA Atlas DSS</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Ffraatlas6730back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background font-body">
    <!-- Navigation Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-full w-80 bg-surface shadow-lg z-50 transform transition-transform duration-300">
        <div class="flex flex-col h-full">
            <!-- Header -->
            <div class="p-6 border-b border-border-light">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        <div>
                            <h1 class="text-lg font-inter font-semibold text-text-primary">FRA Atlas DSS</h1>
                            <p class="text-sm text-text-secondary">Interactive Map Dashboard</p>
                        </div>
                    </div>
                    <button id="sidebarToggle" class="p-2 rounded-md hover:bg-gray-100 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Navigation Menu -->
            <nav class="flex-1 p-4 space-y-2">
                <a href="interactive_map_dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-primary-50 text-primary-700 font-medium">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span>Interactive Map</span>
                </a>
                <a href="claims_management_dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    <span>Claims Management</span>
                </a>
                <a href="ai_insights_dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2.5-5H19V4h-3V2H8v2H5v2h-.5C3.67 6 3 6.67 3 7.5S3.67 9 4.5 9H5v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9h.5c.83 0 1.5-.67 1.5-1.5S20.33 6 19.5 6z"/>
                    </svg>
                    <span>AI Insights</span>
                </a>
                <a href="community_input_portal.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.54 8H17c-.8 0-1.54.37-2.01.99L14 10l-1.99-1.01A2.5 2.5 0 0 0 10 8H8.46c-.8 0-1.54.37-2.01.99L5.5 10H8v12h2v-6h4v6h6z"/>
                    </svg>
                    <span>Community Portal</span>
                </a>
                <a href="advanced_search_analytics.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg text-text-secondary hover:bg-gray-50 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    <span>Advanced Search</span>
                </a>
            </nav>

            <!-- State Selection -->
            <div class="p-4 border-t border-border-light">
                <h3 class="text-sm font-medium text-text-primary mb-3">Select State</h3>
                <div class="space-y-2">
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                        <span class="text-sm text-text-secondary">Madhya Pradesh</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                        <span class="text-sm text-text-secondary">Tripura</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                        <span class="text-sm text-text-secondary">Odisha</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                        <span class="text-sm text-text-secondary">Telangana</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="transition-all duration-300 ml-80">
        <!-- Top Header -->
        <header class="bg-surface shadow-sm border-b border-border-light">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <button id="menuToggle" class="p-2 rounded-md hover:bg-gray-100 transition-colors lg:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    <div>
                        <h2 class="text-xl font-inter font-semibold text-text-primary">Interactive Map Dashboard</h2>
                        <p class="text-sm text-text-secondary">Real-time Forest Rights Act monitoring</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-text-secondary">
                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        <span>Live Data</span>
                    </div>
                    <span class="text-sm text-text-secondary">Last updated: 01 Sep 2025, 9:04 PM</span>
                </div>
            </div>
        </header>

        <!-- Search and Filters Panel -->
        <div class="bg-surface border-b border-border-light p-6">
            <div class="max-w-7xl mx-auto">
                <!-- Natural Language Search -->
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" placeholder="Ask anything... e.g., 'Show pending claims in Odisha tribal areas'" class="w-full pl-12 pr-4 py-3 border border-border-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-base" />
                        <svg class="absolute left-4 top-3.5 w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <!-- Quick Filters -->
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-text-primary">Status:</label>
                        <select class="px-3 py-2 border border-border-medium rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                            <option>All Claims</option>
                            <option>Pending</option>
                            <option>Approved</option>
                            <option>Rejected</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-text-primary">District:</label>
                        <select class="px-3 py-2 border border-border-medium rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                            <option>All Districts</option>
                            <option>Bhopal</option>
                            <option>Indore</option>
                            <option>Gwalior</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-text-primary">Time Range:</label>
                        <select class="px-3 py-2 border border-border-medium rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                            <option>Last 30 days</option>
                            <option>Last 6 months</option>
                            <option>Last year</option>
                            <option>All time</option>
                        </select>
                    </div>
                    <button class="px-4 py-2 bg-primary text-white rounded-md text-sm font-medium hover:bg-primary-600 transition-colors">
                        Apply Filters
                    </button>
                    <button class="px-4 py-2 border border-border-medium text-text-secondary rounded-md text-sm hover:bg-gray-50 transition-colors">
                        Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Map Container -->
        <div class="relative h-screen">
            <!-- Map -->
            <div id="map" class="w-full h-full"></div>

            <!-- Map Controls -->
            <div class="absolute top-4 right-4 bg-surface rounded-lg shadow-md p-4 space-y-3 z-10">
                <div class="text-sm font-medium text-text-primary mb-2">Map Layers</div>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                    <span class="text-sm text-text-secondary">Satellite View</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" checked />
                    <span class="text-sm text-text-secondary">Claim Boundaries</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" />
                    <span class="text-sm text-text-secondary">Forest Cover</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" class="rounded border-gray-300 text-primary focus:ring-primary" />
                    <span class="text-sm text-text-secondary">Settlement Areas</span>
                </label>
                <div class="pt-2 border-t border-border-light">
                    <div class="text-sm font-medium text-text-primary mb-2">Layer Opacity</div>
                    <input type="range" min="0" max="100" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
                </div>
            </div>

            <!-- Map Toolbar -->
            <div class="absolute bottom-4 left-4 bg-surface rounded-lg shadow-md p-2 flex items-center space-x-2 z-10">
                <button class="p-2 rounded-md hover:bg-gray-100 transition-colors" title="Zoom In">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </button>
                <button class="p-2 rounded-md hover:bg-gray-100 transition-colors" title="Zoom Out">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                    </svg>
                </button>
                <div class="w-px h-6 bg-border-light"></div>
                <button class="p-2 rounded-md hover:bg-gray-100 transition-colors" title="Measure Distance">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21l3-3 3 3 3-3 3 3V9l-3-3-3 3-3-3-3 3v12z"/>
                    </svg>
                </button>
                <button class="p-2 rounded-md hover:bg-gray-100 transition-colors" title="Full Screen">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                    </svg>
                </button>
            </div>

            <!-- Statistics Panel -->
            <div class="absolute bottom-4 right-4 bg-surface rounded-lg shadow-md p-4 w-80 z-10">
                <h3 class="text-sm font-medium text-text-primary mb-3">Current View Statistics</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">1,247</div>
                        <div class="text-xs text-text-secondary">Total Claims</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-warning">342</div>
                        <div class="text-xs text-text-secondary">Pending</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-success">789</div>
                        <div class="text-xs text-text-secondary">Approved</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-error">116</div>
                        <div class="text-xs text-text-secondary">Rejected</div>
                    </div>
                </div>
                <div class="mt-4 pt-3 border-t border-border-light">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-text-secondary">Area Coverage:</span>
                        <span class="font-medium text-text-primary">2,847 km²</span>
                    </div>
                    <div class="flex items-center justify-between text-sm mt-1">
                        <span class="text-text-secondary">Forest Cover:</span>
                        <span class="font-medium text-text-primary">68.4%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile FAB -->
    <button id="mobileFab" class="fixed bottom-6 right-6 w-14 h-14 bg-primary text-white rounded-full shadow-lg lg:hidden z-50 flex items-center justify-center">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
        </svg>
    </button>

    <!-- Enhanced Claim Details Modal -->
    <div id="claimDetailsModal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-[9999] hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[95vh] overflow-hidden border border-gray-200 relative z-[10000]">
                <!-- Modal Header -->
                <div class="flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-blue-50">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div>
                            <h2 id="modalTitle" class="text-xl font-bold text-gray-900">Claim Details</h2>
                            <p class="text-sm text-gray-600">Forest Rights Act Claim Information</p>
                        </div>
                    </div>
                    <button id="closeModal" class="p-2 rounded-lg hover:bg-gray-100 transition-colors group">
                        <svg class="w-6 h-6 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Modal Content -->
                <div class="overflow-y-auto max-h-[75vh]">
                    <div id="modalContent" class="p-6">
                        <!-- Content will be dynamically populated -->
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50">
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Last updated: <span id="lastUpdatedTime"></span></span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button id="trackClaim" class="flex items-center space-x-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>Track</span>
                        </button>
                        <button id="downloadReport" class="flex items-center space-x-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-colors font-medium shadow-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <span>View Details</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize map
        const map = L.map('map').setView([23.2599, 77.4126], 6);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Sample claim data with expanded information
        const claimMarkers = [
            { 
                lat: 23.2599, 
                lng: 77.4126, 
                status: 'pending', 
                title: 'Claim #MP001', 
                district: 'Bhopal',
                claimant: 'Ram Singh Patel',
                area: '2.5 hectares',
                submissionDate: '2024-12-15',
                lastUpdate: '2025-01-15',
                description: 'Individual forest rights claim for ancestral agriculture land. Traditional cultivation practices have been followed by the family for over three generations in this forest area.',
                documents: ['Community Certificate', 'Survey Settlement Records', 'Affidavit', 'Revenue Records'],
                village: 'Ramgarh',
                tehsil: 'Huzur',
                coordinates: '23.2599°N, 77.4126°E',
                claimType: 'Individual Forest Rights',
                estimatedValue: '₹4.2 Lakhs',
                priority: 'High'
            },
            { 
                lat: 23.8103, 
                lng: 86.4316, 
                status: 'approved', 
                title: 'Claim #OD002', 
                district: 'Mayurbhanj',
                claimant: 'Maya Devi',
                area: '1.8 hectares',
                submissionDate: '2024-10-20',
                lastUpdate: '2025-01-10',
                description: 'Community forest resource rights claim approved for sustainable collection of minor forest produce including sal seeds and bamboo.',
                documents: ['Gram Sabha Resolution', 'Forest Settlement Records', 'Community Certificate'],
                village: 'Bangiriposi',
                tehsil: 'Bangiriposi',
                coordinates: '23.8103°N, 86.4316°E',
                claimType: 'Community Forest Rights',
                estimatedValue: '₹3.1 Lakhs',
                priority: 'Medium'
            },
            { 
                lat: 23.8315, 
                lng: 91.2868, 
                status: 'pending', 
                title: 'Claim #TR003', 
                district: 'West Tripura',
                claimant: 'Joymati Tripura',
                area: '3.2 hectares',
                submissionDate: '2024-11-30',
                lastUpdate: '2025-01-20',
                description: 'Traditional dwelling and cultivation rights claim in forest area. Includes customary seasonal resource access rights.',
                documents: ['Revenue Records', 'Community Certificate', 'Survey Records'],
                village: 'Teliamura',
                tehsil: 'Teliamura',
                coordinates: '23.8315°N, 91.2868°E',
                claimType: 'Traditional Rights',
                estimatedValue: '₹5.8 Lakhs',
                priority: 'High'
            },
            { 
                lat: 17.3850, 
                lng: 78.4867, 
                status: 'rejected', 
                title: 'Claim #TG004', 
                district: 'Hyderabad',
                claimant: 'Laxmi Narasimha',
                area: '1.2 hectares',
                submissionDate: '2024-09-10',
                lastUpdate: '2025-01-05',
                description: 'Individual forest rights claim rejected due to insufficient documentation and overlapping with reserved forest area.',
                documents: ['Incomplete Survey Records', 'Affidavit'],
                village: 'Chevella',
                tehsil: 'Chevella',
                coordinates: '17.3850°N, 78.4867°E',
                rejectionReason: 'Insufficient evidence of traditional occupation and overlap with protected forest area.',
                claimType: 'Individual Forest Rights',
                estimatedValue: '₹2.4 Lakhs',
                priority: 'Low'
            },
            { 
                lat: 22.9734, 
                lng: 78.6569, 
                status: 'approved', 
                title: 'Claim #MP005', 
                district: 'Jabalpur',
                claimant: 'Ganga Prasad',
                area: '4.1 hectares',
                submissionDate: '2024-08-15',
                lastUpdate: '2024-12-20',
                description: 'Community forest resource rights approved for bamboo cultivation and collection. Includes seasonal grazing rights for cattle.',
                documents: ['Gram Sabha Resolution', 'Forest Settlement Records', 'Revenue Records', 'Community Certificate'],
                village: 'Panagar',
                tehsil: 'Panagar',
                coordinates: '22.9734°N, 78.6569°E',
                claimType: 'Community Forest Rights',
                estimatedValue: '₹7.3 Lakhs',
                priority: 'Medium'
            }
        ];

        // Function to show enhanced claim details modal
        function showClaimDetails(claim) {
            const modal = document.getElementById('claimDetailsModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const lastUpdatedTime = document.getElementById('lastUpdatedTime');

            modalTitle.textContent = claim.title;
            lastUpdatedTime.textContent = new Date(claim.lastUpdate).toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const statusConfig = {
                'approved': { 
                    color: 'text-green-700', 
                    bg: 'bg-green-100', 
                    border: 'border-green-200',
                    icon: 'M5 13l4 4L19 7'
                },
                'pending': { 
                    color: 'text-orange-700', 
                    bg: 'bg-orange-100', 
                    border: 'border-orange-200',
                    icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'
                },
                'rejected': { 
                    color: 'text-red-700', 
                    bg: 'bg-red-100', 
                    border: 'border-red-200',
                    icon: 'M6 18L18 6M6 6l12 12'
                }
            };

            const config = statusConfig[claim.status];

            modalContent.innerHTML = `
                <div class="space-y-6">
                    <!-- Status and Priority Header -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center space-x-2 px-4 py-2 ${config.bg} ${config.border} border rounded-full">
                                <svg class="w-4 h-4 ${config.color}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${config.icon}"/>
                                </svg>
                                <span class="text-sm font-semibold ${config.color}">${claim.status.charAt(0).toUpperCase() + claim.status.slice(1)}</span>
                            </div>
                            <div class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">
                                ${claim.priority} Priority
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-gray-900">${claim.estimatedValue}</div>
                            <div class="text-xs text-gray-500">Estimated Value</div>
                        </div>
                    </div>

                    <!-- Key Information Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                <h4 class="font-semibold text-blue-800">Claimant</h4>
                            </div>
                            <p class="text-blue-700 font-medium">${claim.claimant}</p>
                            <p class="text-blue-600 text-sm">${claim.village}, ${claim.tehsil}</p>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"/>
                                </svg>
                                <h4 class="font-semibold text-green-800">Area & Location</h4>
                            </div>
                            <p class="text-green-700 font-medium">${claim.area}</p>
                            <p class="text-green-600 text-xs">${claim.coordinates}</p>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex items-center space-x-2 mb-2">
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-6m-2-5a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <h4 class="font-semibold text-purple-800">Claim Type</h4>
                            </div>
                            <p class="text-purple-700 font-medium text-sm">${claim.claimType}</p>
                            <p class="text-purple-600 text-xs">${claim.district} District</p>
                        </div>
                    </div>

                    <!-- Detailed Information Sections -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Personal Information -->
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold text-gray-900 border-b border-gray-200 pb-2">Claimant Information</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Name:</span>
                                    <span class="text-gray-900">${claim.claimant}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Village:</span>
                                    <span class="text-gray-900">${claim.village}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Tehsil:</span>
                                    <span class="text-gray-900">${claim.tehsil}</span>
                                </div>
                                <div class="flex justify-between items-center py-2">
                                    <span class="text-gray-600 font-medium">District:</span>
                                    <span class="text-gray-900">${claim.district}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Claim Details -->
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold text-gray-900 border-b border-gray-200 pb-2">Claim Details</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Area:</span>
                                    <span class="text-gray-900 font-semibold">${claim.area}</span>
                                </div>
                                <div class="flex justify-between items-start py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Coordinates:</span>
                                    <span class="text-gray-900 text-right text-sm">${claim.coordinates}</span>
                                </div>
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-600 font-medium">Submitted:</span>
                                    <span class="text-gray-900">${new Date(claim.submissionDate).toLocaleDateString('en-IN')}</span>
                                </div>
                                <div class="flex justify-between items-center py-2">
                                    <span class="text-gray-600 font-medium">Last Update:</span>
                                    <span class="text-gray-900">${new Date(claim.lastUpdate).toLocaleDateString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-3 flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span>Description</span>
                        </h3>
                        <p class="text-gray-700 leading-relaxed">${claim.description}</p>
                    </div>

                    ${claim.rejectionReason ? `
                    <!-- Rejection Reason -->
                    <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg">
                        <div class="flex items-start space-x-2">
                            <svg class="w-5 h-5 text-red-500 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                            </svg>
                            <div>
                                <h4 class="text-red-800 font-semibold">Rejection Reason</h4>
                                <p class="text-red-700 mt-1">${claim.rejectionReason}</p>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Supporting Documents -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span>Supporting Documents</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${claim.documents.map(doc => `
                                <div class="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors group">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                            </svg>
                                        </div>
                                        <span class="text-gray-900 font-medium">${doc}</span>
                                    </div>
                                    <button class="text-blue-600 hover:text-blue-800 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Process Timeline -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-gray-900 flex items-center space-x-2">
                            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>Process Timeline</span>
                        </h3>
                        <div class="relative">
                            <div class="absolute left-5 top-5 bottom-0 w-0.5 bg-gray-300"></div>
                            <div class="space-y-6">
                                <div class="flex items-start space-x-4">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full mt-2 relative z-10"></div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-900">Claim Submitted</p>
                                        <p class="text-sm text-gray-600">${new Date(claim.submissionDate).toLocaleDateString('en-IN', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })}</p>
                                        <p class="text-xs text-gray-500 mt-1">Initial submission with required documents</p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-4">
                                    <div class="w-3 h-3 ${claim.status === 'pending' ? 'bg-orange-500 animate-pulse' : 'bg-blue-500'} rounded-full mt-2 relative z-10"></div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-900">Under Review</p>
                                        <p class="text-sm text-gray-600">Documentation verification and field assessment</p>
                                        ${claim.status === 'pending' ? '<p class="text-xs text-orange-600 mt-1">Currently in progress</p>' : ''}
                                    </div>
                                </div>
                                ${claim.status !== 'pending' ? `
                                <div class="flex items-start space-x-4">
                                    <div class="w-3 h-3 ${claim.status === 'approved' ? 'bg-green-500' : 'bg-red-500'} rounded-full mt-2 relative z-10"></div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-900">Claim ${claim.status === 'approved' ? 'Approved' : 'Rejected'}</p>
                                        <p class="text-sm text-gray-600">${new Date(claim.lastUpdate).toLocaleDateString('en-IN', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })}</p>
                                        <p class="text-xs ${claim.status === 'approved' ? 'text-green-600' : 'text-red-600'} mt-1">
                                            ${claim.status === 'approved' ? 'Rights granted successfully' : 'Claim rejected with reasons provided'}
                                        </p>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.classList.remove('hidden');
        }

        // Add markers to map
        claimMarkers.forEach(claim => {
            const color = claim.status === 'approved' ? 'green' : 
                         claim.status === 'pending' ? 'orange' : 'red';
            
            const marker = L.circleMarker([claim.lat, claim.lng], {
                color: color,
                fillColor: color,
                fillOpacity: 0.7,
                radius: 10,
                weight: 2
            }).addTo(map);

            marker.bindPopup(`
                <div class="p-3 min-w-[200px]">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-900">${claim.title}</h4>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                            claim.status === 'approved' ? 'bg-green-100 text-green-800' : 
                            claim.status === 'pending' ? 'bg-orange-100 text-orange-800' : 'bg-red-100 text-red-800'
                        }">
                            ${claim.status}
                        </span>
                    </div>
                    <div class="space-y-1 mb-3 text-sm">
                        <p><span class="font-medium">Claimant:</span> ${claim.claimant}</p>
                        <p><span class="font-medium">Village:</span> ${claim.village}</p>
                        <p><span class="font-medium">District:</span> ${claim.district}</p>
                        <p><span class="font-medium">Area:</span> ${claim.area}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="showClaimDetails(claimMarkers.find(c => c.title === '${claim.title}'))" class="flex-1 px-3 py-1 bg-primary text-white text-xs rounded-md hover:bg-primary-600 transition-colors font-medium">
                            View Details
                        </button>
                        <button class="px-3 py-1 border border-gray-300 text-gray-700 text-xs rounded-md hover:bg-gray-50 transition-colors">
                            Track
                        </button>
                    </div>
                </div>
            `, {
                maxWidth: 300,
                className: 'custom-popup'
            });
        });

        // Modal functionality
        const modal = document.getElementById('claimDetailsModal');
        const closeModal = document.getElementById('closeModal');
        
        closeModal.addEventListener('click', () => {
            modal.classList.add('hidden');
        });

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });

        // Enhanced modal footer buttons functionality
        document.getElementById('trackClaim').addEventListener('click', () => {
            // Enhanced tracking functionality
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-100 border border-blue-300 text-blue-800 px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity duration-300';
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Tracking information has been sent to your registered mobile number</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        });

        document.getElementById('downloadReport').addEventListener('click', () => {
            // Enhanced download functionality
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-100 border border-green-300 text-green-800 px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity duration-300';
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span>Detailed report is being prepared and will be downloaded shortly</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        });

        // Sidebar toggle functionality
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const menuToggle = document.getElementById('menuToggle');
        const mobileFab = document.getElementById('mobileFab');

        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            if (window.innerWidth >= 1024) {
                mainContent.classList.toggle('ml-80');
                mainContent.classList.toggle('ml-0');
            }
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        menuToggle.addEventListener('click', toggleSidebar);
        mobileFab.addEventListener('click', toggleSidebar);

        // Responsive behavior
        function handleResize() {
            if (window.innerWidth < 1024) {
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('ml-80');
                mainContent.classList.add('ml-0');
            } else {
                sidebar.classList.remove('-translate-x-full');
                mainContent.classList.add('ml-80');
                mainContent.classList.remove('ml-0');
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // Initial call

        // Map resize on sidebar toggle
        setTimeout(() => {
            map.invalidateSize();
        }, 300);

        // Escape key to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                modal.classList.add('hidden');
            }
        });

        // Add custom CSS for popup styling
        const style = document.createElement('style');
        style.textContent = `
            .custom-popup .leaflet-popup-content-wrapper {
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
            .custom-popup .leaflet-popup-tip {
                border-top-color: white;
            }
        `;
        document.head.appendChild(style);
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>